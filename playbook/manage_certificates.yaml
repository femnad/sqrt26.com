---
- hosts:
    stuff
  name:
    Manage certificates with certbot

  tasks:
    - name:
        Stop HAProxy
      service:
        name:
          haproxy
        state:
          stopped
      become:
        yes

    - name:
        Generate certificate
      certbot:
        domains:
          - sqrt26.com
          - www.sqrt26.com
          - yampir.com # until that domain expires
          - www.yampir.com # ditto
        authentication:
          standalone
        expand:
          yes
      become:
        yes

    - name:
        Start HAProxy
      service:
        name:
          haproxy
        state:
          started
      become:
        yes
